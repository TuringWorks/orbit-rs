# =============================================================================
# Orbit Server Configuration for Standalone/Bare-Metal Deployment
# =============================================================================
# This configuration demonstrates a 3-node cluster deployment using Raft
# consensus for leader election on standalone servers.
# =============================================================================

# -----------------------------------------------------------------------------
# Server Identification
# -----------------------------------------------------------------------------
[server]
node_id = "node-1"
bind_address = "0.0.0.0"
environment = "Production"
data_dir = "/var/lib/orbit-rs"
config_dir = "/etc/orbit-rs"

# -----------------------------------------------------------------------------
# Actor System
# -----------------------------------------------------------------------------
[actor_system]
max_actors = 10000
mailbox_size = 1000
supervision_strategy = "OneForOne"

[actor_system.cluster]
seed_nodes = ["192.168.1.10:7946", "192.168.1.11:7946", "192.168.1.12:7946"]
gossip_port = 7946
heartbeat_interval_ms = 1000
failure_timeout_ms = 5000

# -----------------------------------------------------------------------------
# Protocol Servers
# -----------------------------------------------------------------------------
[protocols.grpc]
enabled = true
port = 50051
max_concurrent_streams = 1000
max_message_size = 4194304

[protocols.postgresql]
enabled = true
port = 5432
max_connections = 1000
connection_timeout_secs = 30

[protocols.postgresql.sql_engine]
max_query_complexity = 1000
query_timeout_secs = 30
enable_optimization = true
enable_caching = true
cache_size_mb = 256

[protocols.postgresql.vector_ops]
default_metric = "cosine"
max_dimensions = 4096
batch_size = 1000
enable_simd = true

[protocols.postgresql.vector_ops.indexing]
default_algorithm = "hnsw"

[protocols.postgresql.vector_ops.indexing.hnsw]
m = 16
ef_construction = 200
ef_search = 50

[protocols.postgresql.vector_ops.indexing.ivf]
nlist = 100
nprobe = 10

[protocols.postgresql.features]
enable_pgvector = true
enable_postgis = false
enable_json = true
enable_fulltext = true
enable_prepared_statements = true
enable_transactions = true

[protocols.mysql]
enabled = true
port = 3306
max_connections = 1000
connection_timeout_secs = 30
server_version = "8.0.0-Orbit"
authentication_enabled = false

[protocols.cql]
enabled = true
port = 9042
max_connections = 1000
connection_timeout_secs = 30
protocol_version = 4
authentication_enabled = false

[protocols.redis]
enabled = true
port = 6379
max_connections = 1000
connection_timeout_secs = 30

[protocols.redis.commands]
enabled_groups = [
    "generic", "string", "list", "hash", "set", "zset",
    "vector", "search", "json", "graph", "stream", "pubsub"
]
disabled_commands = []
command_timeout_secs = 30
max_pipeline_size = 1000

[protocols.redis.vector_ops]
default_metric = "cosine"
max_dimensions = 4096
batch_size = 1000
enable_simd = true

[protocols.redis.vector_ops.indexing]
default_algorithm = "hnsw"

[protocols.redis.vector_ops.indexing.hnsw]
m = 16
ef_construction = 200
ef_search = 50

[protocols.redis.vector_ops.indexing.ivf]
nlist = 100
nprobe = 10

[protocols.redis.features]
enable_streams = true
enable_pubsub = true
enable_modules = false
enable_redisearch = true
enable_redisjson = true
enable_redisgraph = true
enable_cluster = false

[protocols.rest]
enabled = true
port = 8080
max_connections = 1000
request_timeout_secs = 30

[protocols.cypher]
enabled = true
port = 7687
max_connections = 1000

[protocols.orbitql]
enabled = true
port = 8081
max_connections = 1000
connection_timeout_secs = 30
authentication_enabled = false

[protocols.aql]
enabled = true
port = 8529
max_connections = 1000
connection_timeout_secs = 30
authentication_enabled = false

# -----------------------------------------------------------------------------
# Security
# -----------------------------------------------------------------------------
[security.authentication]
enabled = false
methods = ["Basic"]

[security.authorization]
enabled = false
model = "rbac"
default_permissions = ["read", "write"]

# Production TLS (uncomment for production)
# [security.encryption.in_transit]
# enabled = true
# tls_version = "TLS1.3"
# cipher_suites = ["TLS_AES_256_GCM_SHA384", "TLS_CHACHA20_POLY1305_SHA256"]

# -----------------------------------------------------------------------------
# Performance (optimized for dedicated servers)
# -----------------------------------------------------------------------------
[performance.memory]
max_memory_mb = 8192

[performance.memory.pool_config]
initial_size_mb = 512
max_size_mb = 4096
growth_factor = 1.5

[performance.memory.gc_settings]
auto_gc = true
interval_secs = 300
memory_threshold_pct = 80.0

[performance.io]
max_concurrent_ops = 2000
timeout_secs = 30
buffer_size_kb = 128
enable_direct_io = false

[performance.network]
tcp_nodelay = true
keep_alive = true
recv_buffer_size = 65536
send_buffer_size = 65536

[performance.cpu]
worker_threads = 8
enable_affinity = true
enable_simd = true

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
[logging]
level = "info"
format = "json"

[[logging.outputs]]
output_type = "stdout"

[[logging.outputs]]
output_type = "file"
file_path = "/var/log/orbit-rs/server.log"

[logging.outputs.rotation]
strategy = "size"
max_size_mb = 100
max_files = 10

# -----------------------------------------------------------------------------
# Monitoring
# -----------------------------------------------------------------------------
[monitoring.metrics]
enabled = true
port = 9090
format = "prometheus"
collection_interval_secs = 30
retention_days = 7

[monitoring.health_checks]
enabled = true
port = 8082
interval_secs = 30
timeout_secs = 5

[monitoring.tracing]
enabled = false
backend = "jaeger"
sampling_rate = 0.1

# -----------------------------------------------------------------------------
# Connection Pooling
# -----------------------------------------------------------------------------
[pooling]
enabled = true
min_connections = 10
max_connections = 200
connection_timeout_secs = 30
idle_timeout_secs = 300
max_lifetime_secs = 3600
health_check_interval_secs = 30
load_balancing_strategy = "LeastConnections"
tier = "Application"
enable_dynamic_sizing = true
target_utilization = 0.75

[pooling.circuit_breaker]
enabled = true
failure_threshold = 5
failure_window_secs = 60
recovery_timeout_secs = 30
success_threshold = 3
half_open_max_calls = 3

# -----------------------------------------------------------------------------
# Persistence
# -----------------------------------------------------------------------------
[persistence.defaults]
addressable = "rocksdb"
cluster = "rocksdb"

[persistence.dynamic]
enable_performance_monitoring = true
performance_window = 300
enable_auto_scaling = false

[persistence.dynamic.health_monitor]
check_interval = 30
check_timeout = 5
failure_threshold = 3
success_threshold = 2
enable_circuit_breaker = true
circuit_breaker_timeout = 300

[persistence.dynamic.failover]
enable_auto_failover = true
strategy = "Priority"
max_attempts = 3
retry_delay = 10
enable_failback = true
failback_delay = 300

[persistence.providers.rocksdb]
type = "RocksDB"
path = "/var/lib/orbit-rs/rocksdb"
create_if_missing = true
max_open_files = 1000
write_buffer_size = 67108864
max_write_buffer_number = 3
target_file_size_base = 67108864
compression = "Lz4"
enable_statistics = true

# -----------------------------------------------------------------------------
# Deployment (Standalone/Bare-Metal)
# -----------------------------------------------------------------------------
[deployment]
mode = "standalone"
cluster_name = "orbit-standalone-cluster"

[deployment.discovery]
method = "static"

[[deployment.discovery.static_nodes]]
id = "node-1"
address = "192.168.1.10:50051"

[[deployment.discovery.static_nodes]]
id = "node-2"
address = "192.168.1.11:50051"

[[deployment.discovery.static_nodes]]
id = "node-3"
address = "192.168.1.12:50051"

# Alternative: DNS-based discovery
# [deployment.discovery.dns]
# service_name = "orbit-cluster.local"
# port = 50051
# query_interval = "30s"

# Alternative: Consul-based discovery
# [deployment.discovery.consul]
# address = "consul.service.consul:8500"
# service_name = "orbit-server"
# health_check = true
# query_interval = "30s"

# Alternative: etcd-based discovery
# [deployment.discovery.etcd]
# endpoints = ["etcd-1.orbit.local:2379", "etcd-2.orbit.local:2379", "etcd-3.orbit.local:2379"]
# key_prefix = "/orbit-rs/nodes"
# query_interval = "30s"

[deployment.election]
method = "raft"
enable_k8s_fallback = false

[deployment.election.raft]
election_timeout_min = "150ms"
election_timeout_max = "300ms"
heartbeat_interval = "50ms"
max_entries_per_request = 100
log_compaction_threshold = 1000

[deployment.election.quorum]
min_quorum_size = 2
max_failures = 1
quorum_timeout = "10s"
dynamic_quorum = false

[deployment.storage]
data_dir = "/var/lib/orbit-rs"
election_state_file = "election-state.json"
transaction_log_file = "transactions.db"
backup_enabled = true
backup_interval = "1h"

# -----------------------------------------------------------------------------
# Environment Overrides
# -----------------------------------------------------------------------------
[environments.development]
[environments.development.logging]
level = "debug"
format = "plain"

[environments.development.deployment.election.raft]
election_timeout_min = "50ms"
election_timeout_max = "100ms"
heartbeat_interval = "25ms"

[environments.production]
[environments.production.security.authentication]
enabled = true

[environments.production.security.encryption.in_transit]
enabled = true
tls_version = "TLS1.3"

[environments.production.logging]
level = "warn"

[environments.production.performance.cpu]
worker_threads = 16
